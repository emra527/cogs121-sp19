<!DOCTYPE html>
<html>
<!-- Educator screen 1 | Start a Plan-->
<head>
	<title>Art Museum Portal | Educator</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
  <link rel="stylesheet" href="../css/home.css">
  <script src="jquery-3.3.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

  <script type="text/javascript">
  const apikey = '3626f450-6473-11e9-a8d2-cd4f8edc6e52';
  // jQuery convention for running when the document has been fully loaded:
  $(document).ready(() => {
    let nextrequest; let prevrequest;
    console.log("redirecting");
    $('#next').hide(); $('#back').hide();
    if(window.localStorage.getItem('logInStatus')){
    }else{
     window.location.href="home_withBackend.html";
   }
   $('#exampleModal').modal();
$('#searchButton').click(() => {
  const requestURL = 'https://api.harvardartmuseums.org/object?size=10&apikey=' + apikey + '&keyword=' + $('#searchQuery').val();
  console.log(requestURL);
  console.log('making ajax request to:', requestURL);
  $.ajax({
      // all URLs are relative to http://localhost:3000/
      url: requestURL,
      type: 'GET',
      dataType : 'json', // this URL returns data in JSON format
      success: (data) => {
        console.log('You received some data!', data);

        if (data.records) {
          $('#featuredlist').empty();
          $('#featuredlist').append('<h4>Results Found: ' + data.info.totalrecords + '</h4>');
          $('#featuredlist').append('<h6>Page: ' + data.info.page + '</h6>');
          var titles = new Array();
          var id = new Array();
          data.records.forEach((e) => {
            titles.push(e.title);
            id.push(e.id)
          });
          for (var x=0; x<titles.length; x++){
            $('#featuredlist').append(
              '<div class="exhibit-checks"><input class="form-check-input" type="checkbox" value="" id="' + x + '"><label class="form-check-label" for="' + x + '">' + titles[x] + '</label><button type="button" class="btn btn-link" style = "font-size: 10px;" data-toggle="modal" data-target="#modal" onclick=moreData("' + 'https://api.harvardartmuseums.org/object/' + id[x] + '?apikey=' + apikey + '")>More Info...</button></div>');
          }
          $('#next').show(); $('#back').show();
          if(data.info.next) {nextrequest = data.info.next; console.log(nextrequest);}
          if(data.info.prev) {prevrequest = data.info.prev;}
        } else {
          $('#featured-exhibits').html('No results found!');
          $('#featuredlist').hide();
        }

      },
    });

    // define a generic Ajax error handler:
    // http://api.jquery.com/ajaxerror/
    $(document).ajaxError(() => {
      $('#status').html('Error: unknown ajaxError!');
    });
  }); 
  $('#next').click(() =>
          {
            if(nextrequest) {
              $.ajax({
                url: nextrequest,
                type: 'GET',
                dataType: 'json',
                success: (data) => {
                  $('#featuredlist').empty();
                  $('#featuredlist').append('<h4>Results Found: ' + data.info.totalrecords + '</h4>');
                  $('#featuredlist').append('<h6>Page: ' + data.info.page + '</h6>');
                  var titles = new Array();
                  var id = new Array();
                  data.records.forEach((e) => {
                    titles.push(e.title);
                    id.push(e.id)
                  });
                  for (var x=0; x<titles.length; x++){
                    $('#featuredlist').append(
                      '<div class="exhibit-checks"><input class="form-check-input" type="checkbox" value="" id="' + x + '"><label class="form-check-label" for="' + x + '">' + titles[x] + '</label><button type="button" class="btn btn-link" style = "font-size: 10px;" data-toggle="modal" data-target="modal" onclick=moreData("' + 'https://api.harvardartmuseums.org/object/' + id[x] + '?apikey=' + apikey + '")>More Info...</button></div>');
                  }
                  if(data.info.next) {nextrequest = data.info.next;}
                  if(data.info.prev) {prevrequest = data.info.prev;}
                },
              });
            }
            else {
              console.log("No Next Page");
            }
          });
    $('#back').click(() =>
          {
            if(prevrequest) {
              $.ajax({
                url: prevrequest,
                type: 'GET',
                dataType: 'json',
                success: (data) => {
                  $('#featuredlist').empty();
                  $('#featuredlist').append('<h4>Results Found: ' + data.info.totalrecords + '</h4>');
                  $('#featuredlist').append('<h6>Page: ' + data.info.page + '</h6>');
                  var titles = new Array();
                  var id = new Array();
                  data.records.forEach((e) => {
                    titles.push(e.title);
                    id.push(e.id)
                  });
                  for (var x=0; x<titles.length; x++){
                    $('#featuredlist').append(
                      '<div class="exhibit-checks"><input class="form-check-input" type="checkbox" value="" id="' + x + '"><label class="form-check-label" for="' + x + '">' + titles[x] + '</label><button type="button" class="btn btn-link" style = "font-size: 10px;" data-toggle="modal" data-target="#modal" onclick=moreData("' + 'https://api.harvardartmuseums.org/object/' + id[x] + '?apikey=' + apikey + '")>More Info...</button></div>');
                  }
                  if(data.info.next) {nextrequest = data.info.next;}
                  if(data.info.prev) {prevrequest = data.info.prev;}
                },
              });
            }
            else {
              console.log("No Prev Page");
            }
          });
});
function moreData(clicklink) {
      console.log(clicklink);
      $.ajax({
        url: clicklink,
        type: 'GET',
        dataType: 'json',
        success: (data) => {
          console.log(data);
          document.getElementById("modalTitle").innerHTML = "Title: " + data.title;
          document.getElementById("modalBody").innerHTML = 
          "<img src =" + data.images[0].baseimageurl + "?height=200&width=200>" +
          "<h6>Artist: " + data.people[0].name + "</h6>";
        },
      });
  }
</script>


</head>

<body>

	<div id="status">current user</div>
	<button id = "logOutButton" class="btn btn-primary">Log out</button>
  <div class="rectangleheader">
  <h1 class="title2">Step 2: Start a Plan</h1>
</div>
  <br>
  <input type="text" placeholder="Search the museum" aria-label="Search" id="searchQuery">
  <button type="submit" value="refresh" class="btn btn-primary mb-2" id="searchButton">Search</button>
  <div class="form-check" id="featuredlist">

  </div>

  <button type="submit" class="btn btn-primary" style="margin-left:40px;" id="back"><</button><button type="submit" class="btn btn-primary" id="next">></button>

  <div id="navigation">

  </div>

  <br>
  

  <div class="back-button">
    <a href="register.html" class="btn btn-primary">< Back</a>
  </div>
  <div class="next-button">
    <a href="pathgenerate.html" class="btn btn-primary">Next ></a>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="modal">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitle"></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" id="modalBody">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
      

</body>
</html>
