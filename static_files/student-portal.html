<!DOCTYPE html>
<html>
<!-- Main student portal | see assigned exhibits -->
<head>
	<title>Art Museum Portal | Educator</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
	<link rel="stylesheet" href="css/home.css">
	<script src="jquery-3.3.1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
	<script type="text/javascript">

	const apikey = '3626f450-6473-11e9-a8d2-cd4f8edc6e52';
	// jQuery convention for running when the document has been fully loaded:
	$(document).ready(() => {
		console.log('page ready');
		if(window.localStorage.getItem('logInStatus')){
		}else{
			window.location.href="home.html";
		}
	const tempuser = window.localStorage.getItem('username');;
	console.log(tempuser);
	$('#status').html('You have logged in as '+ tempuser);
	$('#logOutButton').click((event) => {
		window.localStorage.clear();
		window.location.href="home.html";
	});

	  // define a generic Ajax error handler:
	  // http://api.jquery.com/ajaxerror/
	  $(document).ajaxError(() => {
	  	$('#status').html('Error: unknown ajaxError!');
	  });

	  $.ajax({
		url: 'plans/code/' + window.localStorage.getItem('code'), 
		type: 'GET',
		dataType : 'json', // this URL returns data in JSON format
		success: (data) => {
			display(Object.keys(JSON.parse(data.plan)));
			},
		});

		$('#done').click(() => {
			if($('#assignment > div').length == 0) {
				window.location.href= 'completion.html';
			}
			else {
				alert("You need to complete your assignments!");
			}
		});

	});

	function finish(id) {
		$('#' + id).attr('disabled', 'true');
		document.getElementById("" + id).innerHTML =  "&#10004; Finished";
		$('#div' + id).appendTo($('#completed'));
		$('#br' + id).appendTo($('#completed'));
	}

	function display(plans) {
		let artist = 'Unavailable';
		plans.forEach((e) => {
			$.ajax({
			url: 'https://api.harvardartmuseums.org/object/' + e + '?apikey=' + apikey,
			type: 'GET',
			dataType: 'json',
			success: (data) => {
				if(data.people) {
				artist = data.people[0].name;
			}
			$('#assignment').append(
				`<div class="exhibit-entry" id=div` + e + `>
				<h4>`+ data.title +`</h4>
				<p>`+ artist +`</p>
				<p>`+ data.dated +`</p>
				<button onClick=finish("` + e + `") id="`+ e +`">Finish</button>
				</div><br id=br`+ e +`>`)
			},
			});
		});
	}
</script>
</head>

<body>
	<div id="status">current user</div>
	<button id = "logOutButton" class="btn btn-primary">Log out</button>
	<div class="rectangleheader">
		<h1 class="title2">Assigned Exhibits</h1>
	</div>

	<div class="listview" id="assignment">
		<h1>Assigned:</h1>
	</div>
	<br><br>
	<hr></hr>
	<div class="completed" id="completed">
		<h1 class="title3">Completed:</h1>
	</div>
	<br><br><br>
	<button class = "nextbutton" style="float: right; margin: 20px;" id="done">Finished</button>



</body>
</html>
